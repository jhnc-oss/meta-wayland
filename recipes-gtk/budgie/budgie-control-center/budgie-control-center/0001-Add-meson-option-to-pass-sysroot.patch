From 3cd73885cc5e39d6fc8b32b168d832e0840bf7d4 Mon Sep 17 00:00:00 2001
From: Markus Volk <f_l_k@t-online.de>
Date: Mon, 18 Mar 2024 05:50:21 +0100
Subject: [PATCH] Add meson option to pass sysroot

Signed-off-by: Markus Volk <f_l_k@t-online.de>

Upstream-Status: Inappropriate [OE specific]
---
 meson_options.txt             | 1 +
 panels/background/meson.build | 6 +++---
 panels/common/meson.build     | 4 ++--
 3 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/meson_options.txt b/meson_options.txt
index cec114ca0..9dfab0e4d 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -1,3 +1,4 @@
+option('oe_sysroot', type: 'string', value: '', description: 'Directory for OE-sysroot')
 option('ssh', type: 'boolean', value: false, description: 'build with SSH Socket based connection for remote login')
 option('cheese', type: 'boolean', value: true, description: 'build with cheese webcam support')
 option('documentation', type: 'boolean', value: false, description: 'build documentation')
diff --git a/panels/background/meson.build b/panels/background/meson.build
index a036d2546..f1764f915 100644
--- a/panels/background/meson.build
+++ b/panels/background/meson.build
@@ -35,7 +35,7 @@ common_sources = []
 
 enums = 'gdesktop-enums-types'
 enums_header = files(
-  gsettings_desktop_dep.get_pkgconfig_variable('prefix') + '/include/gsettings-desktop-schemas/gdesktop-enums.h',
+  get_option('oe_sysroot') + gsettings_desktop_dep.get_variable(pkgconfig: 'prefix') + '/include/gsettings-desktop-schemas/gdesktop-enums.h',
   'cc-background-item.h'
 )
 
@@ -43,7 +43,7 @@ common_sources += gnome.mkenums(
   enums + '.h',
   sources: enums_header,
   fhead: '#pragma once\n\n#include <glib-object.h>\n\nG_BEGIN_DECLS\n',
-  fprod: '/* enumerations from "@filename@" */\n',
+  fprod: '/* enumerations from "@basename@" */\n',
   vhead: 'GType @enum_name@_get_type (void) G_GNUC_CONST;\n#define G_DESKTOP_TYPE_@ENUMSHORT@ (@enum_name@_get_type())\n',
   ftail: 'G_END_DECLS\n'
 )
@@ -52,7 +52,7 @@ common_sources += gnome.mkenums(
   enums + '.c',
   sources: enums_header,
   fhead: '#include <gdesktop-enums.h>\n#include "gdesktop-enums-types.h"\n#include "cc-background-item.h"',
-  fprod: '\n/* enumerations from "@filename@" */',
+  fprod: '\n/* enumerations from "@basename@" */',
   vhead: 'GType\n@enum_name@_get_type (void)\n{\n  static GType etype = 0;\n  if (etype == 0) {\n    static const G@Type@Value values[] = {',
   vprod: '      { @VALUENAME@, "@VALUENAME@", "@valuenick@" },',
   vtail: '      { 0, NULL, NULL }\n    };\n    etype = g_@type@_register_static ("@EnumName@", values);\n  }\n  return etype;\n}\n'
diff --git a/panels/common/meson.build b/panels/common/meson.build
index 5e05e4474..20b46e34e 100644
--- a/panels/common/meson.build
+++ b/panels/common/meson.build
@@ -9,7 +9,7 @@ common_sources += gnome.mkenums(
   enums + '.h',
   sources: enums_header,
   fhead: '#pragma once\n\n#include <glib-object.h>\n\nG_BEGIN_DECLS\n',
-  fprod: '/* enumerations from "@filename@" */\n',
+  fprod: '/* enumerations from "@basename@" */\n',
   vhead: 'GType @enum_name@_get_type (void) G_GNUC_CONST;\n#define GSD_TYPE_@ENUMSHORT@ (@enum_name@_get_type())\n',
   ftail: 'G_END_DECLS\n'
 )
@@ -18,7 +18,7 @@ common_sources += gnome.mkenums(
   enums + '.c',
   sources: enums_header,
   fhead: '#include "gsd-device-manager.h"\n#include "gsd-common-enums.h"\n',
-  fprod: '\n/* enumerations from "@filename@" */',
+  fprod: '\n/* enumerations from "@basename@" */',
   vhead: 'GType\n@enum_name@_get_type (void)\n{\n  static GType etype = 0;\n  if (etype == 0) {\n    static const G@Type@Value values[] = {',
   vprod: '      { @VALUENAME@, "@VALUENAME@", "@valuenick@" },',
   vtail: '      { 0, NULL, NULL }\n    };\n    etype = g_@type@_register_static ("@EnumName@", values);\n  }\n  return etype;\n}\n'
